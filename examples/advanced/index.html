<html>
  <head>
    <title>A-Frame Height Grid (Terrain) Component - Basic</title>
    <script src="../build.js"></script>
    <script src="lib/usgsNed.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="my-texture" src="../assets/macaca_nigra_self-portrait.jpg">
      </a-assets>
      
      <a-entity light="type: directional; color: #FFF; intensity: 0.9" position="-100 100 100"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.9" position="100 100 100"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.5" position="0 -100 0"></a-entity>
      <a-entity rotation='0 0 0' position='5 1 13'>
        <a-entity camera look-controls wasd-controls='fly: true' ></a-entity>
      </a-entity>
  
      <a-entity id='terrain' heightgrid='xdimension: 10; zdimension: 10; yscale: 0.0001' material='color: green'></a-entity>  
        
    </a-scene>
  </body>
  <script>
  window.onload = function () {
    var n = 20;
    var lon0 = -119;
    var lat0 = 35;
    var heights = [];
    var el = document.querySelector('#terrain');
    el.setAttribute('heightgrid', { xdimension: n, zdimension: n, yscale: n*3/100000 });
    
    for (var lat = 0; lat < n; lat++) {
      for (var lon = 0; lon < n; lon++) {
        heights.push(0);
        usgsNed.getElevation(lon0+lon/n, lat0-lat/n).
          then(function(result){
            console.log(result, lon, lat);
            var lon = Math.round((result.x - lon0)*n);
            var lat = Math.round((-result.y + lat0)*n);
            
            heights[lon+n*lat]=result.Elevation;
            console.log(heights);
            el.setAttribute('heightgrid','heights',heights);
          },
          function(reason) {
            // rejection
          });
      }
    } 
  }
  </script>
</html>
